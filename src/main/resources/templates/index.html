<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link href='https://css.gg/log-out.css' rel='stylesheet'>
    <!--Import materialize Css-->
    <link type="text/css" rel="stylesheet" href="materialize/css/materialize.min.css" media="screen,projection"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
	  <link rel="stylesheet" href="/style/styleCss.css"/>
    <link
      rel="icon"
      type="imagem/png"
      href="https://seeklogo.com/images/D/dev-logo-DCB5C6D9D3-seeklogo.com.png"
    />
    <title>DEV Systems</title>
  </head>

  <style type="text/css">
  .form-cadastro{
    margin-left: 35%;
    margin-right: 35%;
    margin-top: 3%;
    
  }
  
  
  
  body {
    background: #ffffff 
  }
  .gg-log-off {
    box-sizing: border-box;
    position: relative;
    display: block;
    border-radius: 16px;
    border: 2px solid;
    transform: scale(var(--ggs,1));
    width: 25px;
    height: 25px;
    border-top: 2px solid transparent;
    
  }
.gg-log-off::before {
    content: "";
    display: block;
    box-sizing: border-box;
    position: absolute;
    border-radius: 3px;
    height: 8px;
    width: 2px;
    background: currentColor;
    left: 10px;
    bottom: 11px;
    
  }
  
  .div {
    margin-left: 100%;
  }


  time{
  border: 1px solid #ffffff;
  padding: 4px 12px;
  background-color: rgb(0, 0, 0);
  color: #ffffff;
  font-size: 2em;
  font-weight: 300;
  border-radius: 4px;
  margin-bottom: 100%;
  margin-left: 100%;
}
.btn{
  text-decoration: none;
    color: #fff;
    background-color: #000000;
    text-align: center;
    letter-spacing: .5px;
    -webkit-transition: background-color .2s ease-out;
    transition: background-color .2s ease-out;
    cursor: pointer;
}

.modal {
  display: none;
  position: fixed;
  left: 0;
  right: 0;
  background-color: #f5f5f5;
  padding: 0;
  max-height: 100%;
  width: 45%;
  margin:auto;
  overflow-y: auto;
  border-radius: 2px;
  will-change: top, opacity;
}
  </style>
  <body class="body">
    <nav>
      <div class="nav-wrapper black white-text">
        <a href="#" class="brand-logo center">FORMULÁRIO DE INSCRIÇÃO</a>
        <ul id="nav-mobile" class="left hide-on-med-and-down">
          <li><time></time></li>
          
        </ul>
        
      </div>
    </nav>  
    
    
  
  <div class="form-cadastro" id="form-cadastro">
  
    <form class="form-signin"action="" id="formCadastroUser">
      <div class="mb-3">
        <label for="nome" class="form-label"></label>
        <input type="text" class="form-control" id="nome" required="required" placeholder="Nome" />
      </div>
      <div class="mb-3">
        <label for="idade" class="form-label"></label>
        <input type="number" class="form-control" id="idade"  placeholder="Idade" />
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label"></label>
        <input
          type="Email"
          class="form-control"
          id="email"
          placeholder="Email nome@exemplo.com"
        />
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label"></label>
        <input type="text" class="form-control" id="curso" placeholder="Curso"/>
      </div>
    </form>
    
    <button type="button" class="btn btn-primary" onClick="salvarUsuario()">
      Salvar
    </button>
    <button
      type="button"
      class="btn btn-dark"
      onclick="document.getElementById('formCadastroUser').reset();"
    >
      Novo
    </button>

    <button
      type="button"
      class="btn btn-secondary"
      data-bs-toggle="modal"
      data-bs-target="#modalPesquisaUser"
      onClick="listarUser()"
    >
      Pesquisar
    </button>
    <div class="div" id="div">
      <form th:action="@{/logout}" method="post">
        <h6><b>Sair</b></h6>
        <button 
        type="submit"
        class="gg-log-off" onclick="alert('Você foi desconectado');">
        </button>
     </form>
      </div>
  </div>

    
    <div
      class="modal fade"
      id="modalPesquisaUser"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
    
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">
              Pesquisar usuário cadastrado
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
              onClick="limparCampos()"
              ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="nomeBusca" class="col-form-label"
                  >Informe o nome do usuário:</label
                >
                <input type="text" class="form-control" id="nomeBusca" />
              </div>
              <button
                type="button"
                class="btn btn-secondary"
                onClick="pesquisarUser()"
              >
               Buscar
              </button>
              
              <button
                type="button"
                class="btn btn-dark"
                onClick="listarUser()"
              >
               Listar
              </button>

              <button
                type="button"
                class="btn btn-danger"
                onClick="limparCampos()"
              >
               Limpar
              </button>

              <button type="button" a class="waves-effect waves-light btn" id="gerarPdf"><i class="material-icons right">file_download</i>Relatório</button>


            </form>
          <div style="height: 300px;overflow: scroll;">
            <table class="table" id="tabelaResultado">
              <thead>
                <tr>
                  <th scope="col">Nome</th>
                  <th scope="col">Editar</th>
                  <th scope="col">Remover</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          
        </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
              onClick="limparCampos()"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript">
      
      function limparCampos(){
				$("#nomeBusca").val('');
				$("#tabelaResultado > tbody > tr").remove();
        document.addEventListener('keydown', (event) => {
        if (event.key === 'Escape') {
    // close modal here
  }
})
      } 
     
	   
    
        function pesquisarUser () {
      		var nome = $('#nomeBusca').val();

          
          if (nome != null && nome.trim() != ''){
      		$.ajax({
              method: "GET",
              url: "buscarPorNome",
              data: "nome=" + nome ,
			  success: function(response) {
      
        $('#tabelaResultado > tbody > tr').remove();
				for (var i = 0; i < response.length; i++) {
          $('#tabelaResultado > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].nome+'</td><td><a type="button" onClick="colocarEdicao('+response[i].id+')"><i class="material-icons">edit</i></a></td><td><a type="submit" onClick="deletarUsuario('+response[i].id+')" ><i class="material-icons">delete</i></a></td></tr>');
          
        }   
      
      }
			
			}).fail(function (xhr, status, errorThrown) {
              alert("Erro ao buscar usuário" + xhr.responseText);
            });
		}

      

       }
    
      
   
	   function colocarEdicao(id) {
			
      $.ajax({
              method: "GET",
              url: "buscar",
              data: "idUser=" + id,
              
        success: function(response) {
				$("#nome").val(response.nome);
				$("#idade").val(response.idade);
				$("#email").val(response.email);
				$("#curso").val(response.curso);
				
        
				$('#modalPesquisaUser').modal('hide');
        
      }
			
			}).fail(function (xhr, status, errorThrown) {
              alert("Erro ao buscar id do usuário" + xhr.responseText);
            });
          
    
    }


    


     function deletarUsuario(id) {
      if(confirm('Deseja remover o usuário?')) {
        
      $.ajax({
              method: "DELETE",
              url: "deletar",
              data: "idUser=" + id,
              
              success: function(response) {
              alert("Cadastro deletado! ");
              $('#modalPesquisaUser').modal('hide');
                location.reload();
                location.reload();
               
               
            }
          
          }).fail(function (xhr, status, errorThrown) {
              alert("Erro ao deletar usuário " + xhr.responseText);
            });
     
      }
     }
     
     function listarUser() {
            
            var nome = $("#nome").val();
            
            
            $.ajax({
              method: "GET",
              url: "listar",
              data: "nome=" + nome ,
             success: function (response) {
              
              $("#tabelaResultado > tbody > tr").remove();
      
        for (var i = 0; i < response.length; i++) {
          $('#tabelaResultado > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].nome+'</td><td><a type="button" onClick="colocarEdicao('+response[i].id+')"><i class="material-icons">edit</i></a></td><td><a type="submit" onClick="deletarUsuario('+response[i].id+')" ><i class="material-icons">delete</i></a></td><td></td></tr>');
              }
             
            }    
        }).fail(function (xhr, status, errorThrown) {
              alert("Não foi possivel listar" + xhr.responseText);
            });
          }
          //gerar PDF
          
          $('#gerarPdf').on('click', function () {
              $.ajax({
                  url: 'https://project-cadastro.herokuapp.com/pdf-generate',
                  method: 'GET',
                  xhrFields: {
                      responseType: 'blob'
                  },
                  success: function (data) {
                    var a = document.createElement('a');
                      var url = window.URL.createObjectURL(data);
                      a.href = url;
                      a.download = 'relatorio.pdf';
                      document.body.append(a);
                      a.click();
                      a.remove();
                      window.URL.revokeObjectURL(url);
                  }
              });
          });


     function salvarUsuario() {
            var id = $("#id").val();
            var nome = $("#nome").val();
            var idade = $("#idade").val();
            var email = $("#email").val();
            var curso = $("#curso").val();
        if (nome == null || nome != null && nome.trim() == '') {
          $("#nome").focus();
          alert('Informe o nome');
          return;
        }
        if (idade == null || idade != null && idade.trim() == '') {
          $("#idade").focus();
          alert('Informe a idade');
          return;
        }
        if (email == null || email != null && email.trim() == '') {
          $("#email").focus();
          alert('Informe o email');
          return;
        }
        if (curso == null || curso != null && curso.trim() == '') {
          $("#curso").focus();
          alert('Informe o curso');
          return;
        }
            $.ajax({
              method: "POST",
              url: "salvar",
              data: JSON.stringify({
                nome: nome,
                idade: idade,
                email: email,
                curso: curso,
              }),
              contentType: "application/json; charset=utf-8",
              success: function (response) {
                $("#id").val(response.id);
                alert("Aluno cadastrado com sucesso! ");
                document.getElementById('formCadastroUser').reset();
              },
            }).fail(function (xhr, status, errorThrown) {
              alert("Erro ao cadastrar aluno! " + xhr.responseText);
            });
          }
          

         const showTimeNow = () =>{

        //Selecinando a tag de destino
         const clockTag = document.querySelector('time');
          
        //Instanciando a classe Date
          let dateNow = new Date();

        //pegando os valores desejados
         let hh = dateNow.getHours();
          let mm = dateNow.getMinutes();
          let ss = dateNow.getSeconds();
          
          hh = hh < 10 ? '0'+ hh : hh; 
          mm = mm < 10 ? '0'+ mm : mm; 
          ss = ss < 10 ? '0'+ ss : ss; 
          
          clockTag.innerText = hh +':'+ mm +':'+ ss;
        }

        //executando a funcao a cada 1 segundo
        showTimeNow()
        setInterval(showTimeNow, 1000);
        
        
    
  </script>
  </body>
</html>
