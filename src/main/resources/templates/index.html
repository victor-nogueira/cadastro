<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- Bootstrap CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC"
      crossorigin="anonymous"
    />
    <link
      rel="icon"
      type="imagem/png"
      href="https://seeklogo.com/images/D/dev-logo-DCB5C6D9D3-seeklogo.com.png"
    />
    <title>Sistema DEV</title>
  </head>

  <style type="text/css">
  html{
    margin-left: 35%;
    margin-right: 35%;
    margin-top: 3%;
  
  }
  body {
    background-color:  #f5f5f5;
  }
  
  
  </style>
  <body class="body">
    <div style="text-align: center">
      <img
        src="https://cdn3.iconfinder.com/data/icons/logos-and-brands-adobe/512/84_Dev-512.png"
        width="180"
        height="100"
      />
      <h3 class="font">INSCRIÇÃO DO CURSO</h3>
    </div>
    <div>
    <form class="form-signin"action="" id="formCadastroUser">
      <div class="mb-3">
        <label for="nome" class="form-label"></label>
        <input type="text" class="form-control" id="nome" required="required" placeholder="Nome" />
      </div>
      <div class="mb-3">
        <label for="idade" class="form-label"></label>
        <input type="number" class="form-control" id="idade"  placeholder="Idade" />
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label"></label>
        <input
          type="Email"
          class="form-control"
          id="email"
          placeholder="Email nome@exemplo.com"
        />
      </div>
      <div class="mb-3">
        <label for="exampleFormControlInput1" class="form-label"></label>
        <input type="text" class="form-control" id="curso" placeholder="Curso"/>
      </div>
    </form>
    
    <button type="button" class="btn btn-primary" onClick="salvarUsuario()">
      Salvar
    </button>
    <button
      type="button"
      class="btn btn-dark"
      onclick="document.getElementById('formCadastroUser').reset();"
    >
      Novo
    </button>

    <button
      type="button"
      class="btn btn-danger"
      data-bs-toggle="modal"
      data-bs-target="#modalPesquisaUser"
    >
      Pesquisar
    </button>
    <div
      class="modal fade"
      id="modalPesquisaUser"
      tabindex="-1"
      aria-labelledby="exampleModalLabel"
      aria-hidden="true"
    >
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">
              Pesquisar usuário cadastrado
            </h5>
            <button
              type="button"
              class="btn-close"
              data-bs-dismiss="modal"
              aria-label="Close"
            ></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="nomeBusca" class="col-form-label"
                  >Informe o nome do usuário:</label
                >
                <input type="text" class="form-control" id="nomeBusca" />
              </div>
              <button
                type="button"
                class="btn btn-success"
                onClick="pesquisarUser()"
              >
                Buscar
              </button>
            </form>
          <div style="height: 300px;overflow: scroll;">
            <table class="table" id="tabelaResultado">
              <thead>
                <tr>
                  <th scope="col">Nome</th>
                  <th scope="col">Editar</th>
                  <th scope="col">Deletar</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
          
        </div>
          <div class="modal-footer">
            <button
              type="button"
              class="btn btn-secondary"
              data-bs-dismiss="modal"
            >
              Fechar
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      src="https://code.jquery.com/jquery-3.6.1.min.js"
      integrity="sha256-o88AwQnZB+VDvE9tvIXrMQaPlFFSUTR+nldQm1LuPXQ="
      crossorigin="anonymous"
    ></script>
    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
      crossorigin="anonymous"
    ></script>

    <script type="text/javascript">
       
	   function pesquisarUser () {
      		var nome = $('#nomeBusca').val();
      	if (nome != null && nome.trim() != ''){
      		$.ajax({
              method: "GET",
              url: "buscarPorNome",
              data: "nome=" + nome ,
			  success: function(response) {
				$('#tabelaResultado > tbody > tr').remove();
				
				for (var i = 0; i < response.length; i++) {
					$('#tabelaResultado > tbody').append('<tr id="'+response[i].id+'"><td>'+response[i].nome+'</td><td><button type="button" onClick="colocarEdicao('+response[i].id+')" class="btn btn-primary">Visualizar</button></td><td><button type="button" onClick="deletarUsuario('+response[i].id+')" class="btn btn-danger">Deletar</button></td></tr>');
				}

      
      
      }
			
			}).fail(function (xhr, status, errorThrown) {
              alert("Erro ao buscar usuário" + xhr.responseText);
            });
		}

       }
    

	   function colocarEdicao(id) {
			$.ajax({
              method: "GET",
              url: "buscar",
              data: "idUser=" + id,
			  success: function(response) {
				$("#nome").val(response.nome);
				$("#idade").val(response.idade);
				$("#email").val(response.email);
				$("#curso").val(response.curso);
				
				$('#modalPesquisaUser').modal('hide');
			
      }
			
			}).fail(function (xhr, status, errorThrown) {
              alert("Erro ao buscar id do usuário" + xhr.responseText);
            });
	   }

     function deletarUsuario(id) {
      if(confirm('Deseja remover o usuário?')) {
      
     
      $.ajax({
              method: "DELETE",
              url: "deletar",
              data: "idUser=" + id,
              success: function(response) {
            
              $('#modalPesquisaUser').modal('hide');
                location.reload();
                alert(response);
                location.reload();
               
               
            }
          
          }).fail(function (xhr, status, errorThrown) {
              alert("Erro ao buscar deletar usuário " + xhr.responseText);
            });
     
      }
     }
    
     function salvarUsuario() {
            var id = $("#id").val();
            var nome = $("#nome").val();
            var idade = $("#idade").val();
            var email = $("#email").val();
            var curso = $("#curso").val();
        if (nome == null || nome != null && nome.trim() == '') {
          $("#nome").focus();
          alert('Informe o nome');
          return;
        }
        if (idade == null || idade != null && idade.trim() == '') {
          $("#idade").focus();
          alert('Informe a idade');
          return;
        }
        if (email == null || email != null && email.trim() == '') {
          $("#email").focus();
          alert('Informe o email');
          return;
        }
        if (curso == null || curso != null && curso.trim() == '') {
          $("#curso").focus();
          alert('Informe o curso');
          return;
        }
            $.ajax({
              method: "POST",
              url: "salvar",
              data: JSON.stringify({
                nome: nome,
                idade: idade,
                email: email,
                curso: curso,
              }),
              contentType: "application/json; charset=utf-8",
              success: function (response) {
                $("#id").val(response.id);
                alert("Aluno cadastrado com sucesso! ");
                document.getElementById('formCadastroUser').reset();
              },
            }).fail(function (xhr, status, errorThrown) {
              alert("Erro ao cadastrar aluno! " + xhr.responseText);
            });
          }
    </script>
  </body>
</html>
